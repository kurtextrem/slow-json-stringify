"use strict";var _stringifyCallback=function(r,e){return e.isSJS?e.type+"__sjs":e},_prepare=function(r){var e=JSON.stringify(r,_stringifyCallback);return{_preparedString:e,_preparedSchema:JSON.parse(e)}},__find=function __find(path){for(var str="obj",i=0;i<path.length;++i)str+="?.['"+path[i]+"']";return eval("(obj=>"+str+")")},_arraySerializer=function(r,e){for(var n="",a=e.length-1,t=0;t<a;++t)n+=r(e[t])+",";return n+=r(e[a]),console.log(n),"["+n+"]"},_makeArraySerializer=function(r){return r instanceof Function?_arraySerializer.bind(null,r):JSON.stringify},_arrayNullSerializer=function(r,e){if(null===e)return"null";r(e)},_makeNullArraySerializer=function(r){var e=_makeArraySerializer(r);return _arrayNullSerializer.bind(null,e)},TYPES={number:null,string:null,boolean:null,array:_makeArraySerializer,null:null,nullArray:_makeNullArraySerializer},fnUser=function(r){return r},attr=function(r,e){var n;return{isSJS:!0,type:r,serializer:(null==(n=TYPES[r])?void 0:n.call(TYPES,e))||e||fnUser}},_defaultRegex=new RegExp('\\n|\\r|\\t|\\"|\\\\',"gm"),_escapeCallback=function(r){return"\\"+r},escape=function(r){return void 0===r&&(r=_defaultRegex),function(e){return e.replace(r,_escapeCallback)}},_sjsRegex=/__sjs/;function _prepareQueue(r,e,n,a){if(void 0===a&&(a=[]),_sjsRegex.test(n)){var t=[].concat(a),i=__find(t),u=i(r);e.push({serializer:u.serializer,find:i,name:a[a.length-1]})}else for(var _=Object.keys(n),l=0;l<_.length;++l){var s=_[l];_prepareQueue(r,e,n[s],[].concat(a,[s]))}}var _makeQueue=function(r,e){var n=[];return _prepareQueue(e,n,r),n},_stringRegex=/string/,_replaceString=function(r){return _stringRegex.test(r)?'"__par__"':"__par__"},_isLastRegex=/^("}|})/,_matchStartRe=/^(\"\,|\,|\")/,_makeChunks=function(r,e){for(var n=r.replace(/"\w+__sjs"/gm,_replaceString).split("__par__"),a=[],t=0;t<n.length;++t){var i=n[t],u='("'+(e[t]||{}).name+'":("?))$',_=_isLastRegex.test(n[t+1]||""),l=new RegExp(_?"(,?)"+u:u);a.push({flag:!1,pure:i,prevUndef:i.replace(_matchStartRe,""),isUndef:i.replace(l,""),bothUndef:i.replace(_matchStartRe,"").replace(l,"")})}return a},_select=function(r){return function(e,n){var a=r[n];return void 0!==e?a.flag?a.prevUndef+e:a.pure+e:(r[n+1].flag=!0,a.flag?a.bothUndef:a.isUndef)}},sjs=function(r){var e=_prepare(r),n=e._preparedString,a=_makeQueue(e._preparedSchema,r),t=_makeChunks(n,a),i=_select(t),u=a.length;return function(r){for(var e="",n=0;n!==u;){var _=a[n],l=_.serializer,s=(0,_.find)(r);e+=i(l(s),n),++n}var f=t[t.length-1];return e+(f.flag?f.prevUndef:f.pure)}};exports.attr=attr,exports.escape=escape,exports.sjs=sjs;
//# sourceMappingURL=sjs.js.map
