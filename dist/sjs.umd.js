!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e||self).slowJsonStringify={})}(this,function(exports){"use strict";var _stringifyCallback=function(e,r){return r.isSJS?r.type+"__sjs":r},_prepare=function(e){var r=JSON.stringify(e,_stringifyCallback);return{_preparedString:r,_preparedSchema:JSON.parse(r)}},__find=function __find(path){for(var str="obj",i=0;i<path.length;++i)str+="?.['"+path[i]+"']";return eval("(obj=>"+str+")")},_arraySerializer=function(e,r){for(var n="",a=r.length-1,t=0;t<a;++t)n+=e(r[t])+",";return n+=e(r[a]),console.log(n),"["+n+"]"},_makeArraySerializer=function(e){return e instanceof Function?_arraySerializer.bind(null,e):JSON.stringify},_arrayNullSerializer=function(e,r){if(null===r)return"null";e(r)},_makeNullArraySerializer=function(e){var r=_makeArraySerializer(e);return _arrayNullSerializer.bind(null,r)},TYPES={number:null,string:null,boolean:null,array:_makeArraySerializer,null:null,nullArray:_makeNullArraySerializer},fnUser=function(e){return e},attr=function(e,r){var n;return{isSJS:!0,type:e,serializer:(null==(n=TYPES[e])?void 0:n.call(TYPES,r))||r||fnUser}},_defaultRegex=new RegExp('\\n|\\r|\\t|\\"|\\\\',"gm"),_escapeCallback=function(e){return"\\"+e},escape=function(e){return void 0===e&&(e=_defaultRegex),function(r){return r.replace(e,_escapeCallback)}},_sjsRegex=/__sjs/;function _prepareQueue(e,r,n,a){if(void 0===a&&(a=[]),_sjsRegex.test(n)){var t=[].concat(a),i=__find(t),u=i(e);r.push({serializer:u.serializer,find:i,name:a[a.length-1]})}else for(var l=Object.keys(n),_=0;_<l.length;++_){var s=l[_];_prepareQueue(e,r,n[s],[].concat(a,[s]))}}var _makeQueue=function(e,r){var n=[];return _prepareQueue(r,n,e),n},_stringRegex=/string/,_replaceString=function(e){return _stringRegex.test(e)?'"__par__"':"__par__"},_isLastRegex=/^("}|})/,_matchStartRe=/^(\"\,|\,|\")/,_makeChunks=function(e,r){for(var n=e.replace(/"\w+__sjs"/gm,_replaceString).split("__par__"),a=[],t=0;t<n.length;++t){var i=n[t],u='("'+(r[t]||{}).name+'":("?))$',l=_isLastRegex.test(n[t+1]||""),_=new RegExp(l?"(,?)"+u:u);a.push({flag:!1,pure:i,prevUndef:i.replace(_matchStartRe,""),isUndef:i.replace(_,""),bothUndef:i.replace(_matchStartRe,"").replace(_,"")})}return a},_select=function(e){return function(r,n){var a=e[n];return void 0!==r?a.flag?a.prevUndef+r:a.pure+r:(e[n+1].flag=!0,a.flag?a.bothUndef:a.isUndef)}},sjs=function(e){var r=_prepare(e),n=r._preparedString,a=_makeQueue(r._preparedSchema,e),t=_makeChunks(n,a),i=_select(t),u=a.length;return function(e){for(var r="",n=0;n!==u;){var l=a[n],_=l.serializer,s=(0,l.find)(e);r+=i(_(s),n),++n}var o=t[t.length-1];return r+(o.flag?o.prevUndef:o.pure)}};exports.attr=attr,exports.escape=escape,exports.sjs=sjs});
//# sourceMappingURL=sjs.umd.js.map
